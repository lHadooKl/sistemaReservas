<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestión de Aviones</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 1rem; }
    .table-actions { white-space: nowrap; }
  </style>
</head>
<body>

    <!-- MENÚ SUPERIOR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Reservas Aerolínea</a>
            <div>
                <ul class="navbar-nav">
                    <li class="nav-item"><a href="agentes.html" class="nav-link ">Agentes</a></li>
                    <li class="nav-item"><a href="aviones.html" class="nav-link active">Avión</a></li>
                    <li class="nav-item"><a href="pasajero.html" class="nav-link">Pasajero</a></li>
                    <li class="nav-item"><a href="personalCabina.html" class="nav-link">Personal Cabina</a></li>
                    <li class="nav-item"><a href="piloto.html" class="nav-link">Piloto</a></li>
                    <li class="nav-item"><a href="reservas.html" class="nav-link">Reservas</a></li>
                    <li class="nav-item"><a href="usuario.html" class="nav-link">Usuario</a></li>
                    <li class="nav-item"><a href="vuelo.html" class="nav-link">Vuelo</a></li>
                </ul>
            </div>
        </div>
    </nav>

  <div class="container">
    <h2 class="mb-4">Gestión de Aviones</h2>

    <div id="alertContainer"></div>

    <!-- FORMULARIO -->
    <form id="avionForm" class="row g-3 mb-4">
      <div class="col-md-6">
        <input type="text" id="modelo" class="form-control" placeholder="Modelo del avión" required>
      </div>
      <div class="col-md-6">
        <input type="number" id="capacidad" class="form-control" placeholder="Capacidad (número de pasajeros)" min="1" required>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">Agregar Avión</button>
      </div>
    </form>

    <!-- TABLA -->
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Modelo</th>
          <th>Capacidad</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaAviones"></tbody>
    </table>
  </div>

  <!-- MODAL EDITAR -->
  <div class="modal fade" id="editarModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Avión</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="editId">
          <div class="mb-3">
            <label for="editModelo" class="form-label">Modelo</label>
            <input type="text" id="editModelo" class="form-control" required>
          </div>
          <div class="mb-3">
            <label for="editCapacidad" class="form-label">Capacidad</label>
            <input type="number" id="editCapacidad" class="form-control" min="1" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="guardarEdicion()">Guardar Cambios</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Cambia la URL según tu contexto:
    const apiUrl = 'http://localhost:8080/sistemaReservas/api/aviones';

    let aviones = [];

    document.addEventListener('DOMContentLoaded', () => {
      listarAviones();
      document.getElementById('avionForm').addEventListener('submit', crearAvion);
    });

    function mostrarAlerta(mensaje, tipo = 'success') {
      const alertContainer = document.getElementById('alertContainer');
      alertContainer.innerHTML = `
        <div class="alert alert-${tipo} alert-dismissible fade show" role="alert">
          ${mensaje}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      `;
    }

    function listarAviones() {
      fetch(apiUrl)
        .then(res => {
          if (!res.ok) throw new Error('Error al obtener aviones');
          return res.json();
        })
        .then(data => {
          aviones = data;
          renderTabla();
        })
        .catch(err => mostrarAlerta(err.message, 'danger'));
    }

    function renderTabla() {
      const tbody = document.getElementById('tablaAviones');
      tbody.innerHTML = '';
      aviones.forEach(a => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${a.id_avion}</td>
          <td>${a.modelo}</td>
          <td>${a.capacidad}</td>
          <td class="table-actions">
            <button class="btn btn-sm btn-warning" onclick="abrirEditar(${a.id_avion})">Editar</button>
            <button class="btn btn-sm btn-danger" onclick="eliminarAvion(${a.id_avion})">Eliminar</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function crearAvion(e) {
      e.preventDefault();
      const modelo = document.getElementById('modelo').value.trim();
      const capacidad = parseInt(document.getElementById('capacidad').value);

      if (!modelo || capacidad < 1) {
        mostrarAlerta('Complete los campos correctamente', 'warning');
        return;
      }

      const avion = { modelo, capacidad };

      fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(avion)
      })
        .then(res => {
          if (!res.ok) throw new Error('Error al crear avión');
          return res.json();
        })
        .then(() => {
          mostrarAlerta('Avión agregado correctamente');
          document.getElementById('avionForm').reset();
          listarAviones();
        })
        .catch(err => mostrarAlerta(err.message, 'danger'));
    }

    function abrirEditar(id) {
      const avion = aviones.find(a => a.id_avion === id);
      if (!avion) return;

      document.getElementById('editId').value = avion.id_avion;
      document.getElementById('editModelo').value = avion.modelo;
      document.getElementById('editCapacidad').value = avion.capacidad;

      new bootstrap.Modal(document.getElementById('editarModal')).show();
    }

    function guardarEdicion() {
      const id = document.getElementById('editId').value;
      const modelo = document.getElementById('editModelo').value.trim();
      const capacidad = parseInt(document.getElementById('editCapacidad').value);

      if (!modelo || capacidad < 1) {
        mostrarAlerta('Datos inválidos', 'warning');
        return;
      }

      const avion = { id_avion: parseInt(id), modelo, capacidad };

      fetch(`${apiUrl}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(avion)
      })
        .then(res => {
          if (!res.ok) throw new Error('Error al actualizar avión');
          return res.json();
        })
        .then(() => {
          mostrarAlerta('Avión actualizado correctamente');
          bootstrap.Modal.getInstance(document.getElementById('editarModal')).hide();
          listarAviones();
        })
        .catch(err => mostrarAlerta(err.message, 'danger'));
    }

    function eliminarAvion(id) {
      if (!confirm('¿Seguro que deseas eliminar este avión?')) return;

      fetch(`${apiUrl}/${id}`, { method: 'DELETE' })
        .then(res => {
          if (!res.ok) throw new Error('Error al eliminar avión');
          mostrarAlerta('Avión eliminado correctamente');
          listarAviones();
        })
        .catch(err => mostrarAlerta(err.message, 'danger'));
    }
  </script>
</body>
</html>
